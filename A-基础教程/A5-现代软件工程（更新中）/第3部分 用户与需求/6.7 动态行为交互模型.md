# 动态行为交互模型

行为模型视图：这种视图表示了系统动态和行为。它还描述了在用户模型视图和结构模型视图中所描述的各种结构元素之间的交互和协作。





动态模型表示瞬时的、行为化的系统的“控制”性质，规定了对象模型中对象的合法变化序列。即对象的动态行为。
用状态图来描绘对象的状态、触发状态转换的事件、以及对象的行为（对事件的响应）。
每个类的动态行为用一张状态图来描绘，各个类的状态图通过共享事件合并起来，从而构成系统的动态模型






## 状态转换图（State Machine）

状态转换（迁移）图是描述对象的状态在响应外部的信号后进行转换的一种图形表示。

### 对现实世界对象的状态转换分析

我们以作业对象为例，绘制出状态转换图，如图6.7.1。

<div align="center">
<image src="Images/6-StateMachine1.jpg"/>

图6.7.1 - 需求分析阶段的作业对象状态转换图
</div>

在图6.7.1中，我们可以看到四种图例：

1. 起始和终止状态，圆形；
2. 状态，被观察到的对象行为模式，用圆角矩形表示；
3. 事件或行为，引起状态转换的外界事件，用有方向的连接线表示；
4. 菱形，判断条件。


也可以用表格来表示这种转换关系，但是不如图直接，如表6.7.1。

表6.7.1 - 状态转换表

|源状态\目标状态|到起始|到已接收|到已提交到|到已批改|到终止|
|--|--|--|--|--|--|
|从起始||学生收到作业||||
|从已接收|||学生完成作业|||
|从已提交||||老师批改作业||
|从已批改|||不合格，学生修改作业||作业合格|
|从终止||||||

### 区分需求分析和系统设计的边界

在需求分析阶段，很容易犯的错误是绘制如图6.7.2所示的状态转换图：

<div align="center">
<image src="Images/6-StateMachine2.jpg"/>

图6.7.2 - 系统设计阶段的作业对象状态转换图
</div>

比较图6.7.1和图6.7.2，我们可以看到后者多出来几个状态：

- 未完成
- 已完成
- 批改中

这是为什么呢？

因为前者是现实世界中的状态转换图，是一种（客观）需求分析的结果；而后者是软件世界的状态转换图，是（主观）系统设计的结果。

我们用“未完成”状态为例说明：

- 在现实世界中，未完成的状态确实存在，但是它对环境来说毫无意义，老师最后只看你是不是及时完成了作业，而家长会一直督促你，直到你完成作业，所以，“未完成”状态在现实世界中是一个不可接受的状态；

- 在软件世界中，如果处于“未完成”状态，学生是可以临时保存作业，留着以后再完成的，所以“未完成”状态对于软件系统（环境）来说，是有意义的：可以保存入磁盘，可以再次从磁盘加载到内存。

而“已完成”状态的意义是：到达这个状态后，软件系统才会允许提交作业进入下一个状态，相当于软件代替了老师和家长的监督作用：学生没有完成作业就必须完成，不能提交。

“批改中”的作用和“未完成”类似，也是可以保存入磁盘，以后再次加载的。

依赖于软件系统的支持，学生还可以决定：

- 是否在完成作业后，在回过头来修改；
- 是否在提交作业后，在老师还没有批改的前提下，收回作业，做进一步的修改。



## 时序图/协作图

    交互模型

    描述系统的动态行为，通过时序图/协作图/描述对象的交互，以揭示对象间如何协作来完成每个具体的用例。单个对象的状态变化/动态行为可以通过状态图来表示、


    描述系统的动态结构和对象之间的交互，表示瞬时的、行为化的系统的“控制”特性。面向对象方法中，常用活动图，状态图、时序图、协作图构件系统的动态模型。

    描述系统控制结构
    执行操作
    什么时候做
    在何种状态下接受了什么事件的触发
    交互次序

行为建模是通过活动图描述业务活动流程的过程。在梳理用户场景时会得到具体的业务事件，也对业务事件的办理过程有了大概的了解。接下来需要通过活动图对业务事件的过程进行明确，尽量使用泳道图明确各个活动的使用角色，即使是单角色的流程也应该明确标出角色名称。
       业务流程分为生产性流程、管理性流程和支持性流程。生产性流程是流程中最重要的部分，是企业/组织价值体现的核心；管理性流程是对生产性流程的管控，通常是有管理层发现的，对一些质量、效率进行监督的控制性流程；支持性流程是对生产性流程的一种补充，通常是由协作部门、本部门员工执行的工作。如果拿软件开发过程来比喻的话，需求分析、软件设计、软件编码、软件测试是生产性流程；项目管理、质量保证是管理性流程；而文档配置等属于支持性流程。通常生产性流程是最容易标识的，而管理性流程和支持性流程比较容易忽略，因此在需求分析时要特别注意。
      活动图示例如下图所示：